# mr2022

## Team members
* Alexander Lampalzer
* Erik Lundell

# Tasks

## 0. Documentation

### 0.1 Git Merge

* By: Alexander Lampalzer

See commit `7b26ade4071181c515197d79556595f10e90fe6d`. To verify:

```sh
git log | grep -A 6 7b26ade4071181c515197d79556595f10e90fe6d
```

## 1. Publish the used map. (45 Points)
* By: Alexander Lampalzer

![](docs/map-publish.png)

Self-Localization Visualization and rviz side-by-side.

To test:
```
roslaunch mr_launch view_map.launch
```

*Note: This only starts the self-localization and rviz, without the stage simulator.*

## 2. Initialize self-localization and trigger driving using RViz (50 Points)

### 2.1 `/move_base_simple/goal` (25 Points)

* By: Erik Lundell

See the youtube video below:

[![Planner driving to goal](http://img.youtube.com/vi/ociiIXVt_bI/0.jpg)](https://youtu.be/ociiIXVt_bI "Planner driving to goal")

To test:

```
roslaunch stage_ros world.launch
roslaunch mr_self_localization ekf.launch map:=cave
roslaunch mr_launch planner.launch
rviz
```

Then use rviz and "2D Nav Goal" to navigate the robot.

### 2.2 `/initialpose` (25 Points)

* By: Alexander Lampalzer

![](docs/initialpose.png)

rqt_console showing the initialpose beeing sent by `rviz` and received by `self_localization`. After setting the verbosity level of self_localication to debug, the message can be displayed in `rqt_console`.

## 3. Connect self-localization and planner (45 Points)

* By: Alexander Lampalzer

![asd](docs/odom.png)

The above images shows the transformation from `map` to `odom` beeing broadcasted by the self-localization node. Other transformations have been cut off to save space.

Both the local planenr and the global planner utilize tf2 to get their current position. This can be verified using `rosnode info /mr_planner_node` or in `planner_node.cpp:119-125`

## 4. Planner

### 4.0.1 Your planner is using your self-localization (20 Points)

* By: Erik Lundell

![](docs/1.2.png) ![](docs/1.1.png)

The image to the left above show that the planner node is listening to the tf broadcast. Because of this, the node does not listen to the topic /pose_estimation directly. To the right is a screenshot of Rviz with a red arrow marking the self localization pose.

### 4.0.2 Your planner can be operated with Rviz (20 Points)

![](docs/2.1.png) ![](docs/2.2.png)

* By: Erik Lundell

The image above shows two screenshots of how the robot rotates towards the goal (the red arrow in front of the robot) and then moves towards it.

## 4.1 New Node (50 Points)

* By: Erik Lundell
  
![](docs/3.png)

The planner was implemented in it's own node, mr_planner. Some configurable parameters were also added as seen in the screenshot of rqt_reconfigure above. the planner is easiest run with `roslaunch mr_launch/planner.launch`

## 4.2 Simple, no Obstacle

### 4.2.1 and 4.2.2 Your vehicle can drive to a goal location, stops there and turns into the correct pose. (50 Points)

![](docs/4.png)

A local planner that can drive in a straight path towards a goal pose was implemented as a state machine in the planner node. The control outputs are proportional to the difference between the current pose and the goal (and capped at 0.5).  
The screenshot shows how the robot (red arrow) has stopped and rotated to the goal pose (purple arrow). There is a small mis-alignment because the planner is configured to stop when within a 10 cm radius of the goal, however this can be changed with rqt_reconfigured as seen above. One weakness of the planner is that it does not account for overshooting the goal.

## 4.4 Plan

### 4.4.1 Write a node or modify the planner and/or self-localization to plan a path to the goal location using waypoints and publish it as ROS nav_msgs/Path message. (50 Points)

* By: Alexander Lampalzer

![](docs/global_planner.png)

Above image shows a screenshot of rviz with a path and a costmap from the current robot pose to the target, sepcified by "2D Nav Goal". The path and costmap are generated by th newly created `mr_global_planner` node. Internally, an A* planner was implemented to find the shortest goal from the start to the target.

To start the global planner, run:

```
rosrun mr_global_planner mr_global_planner_node
```

Use the tool "2D Nav Goal" in rviz to specify a target for the global plan. The results will then be published at `/global_planner/costmap` and `/global_planner/path`.

# Scoring

## Overall

| Exercise                        | Points | Author              |
| ------------------------------- | ------ | ------------------- |
| 0. Git Merge                    | 20     | Alexander Lampalzer |
| 1. Map                          | 45     | Alexander Lampalzer |
| 2.1 Planner Goal                | 25     | Erik Lundell        |
| 2.2 initialpose                 | 25     | Alexander Lampalzer |
| 3. Localization & Planner TF    | 45     | Both                |
| 4.0.1 Planner self-localization | 20     | Erik Lundell        |
| 4.0.2 Planner Rviz              | 20     | Erik Lundell        |
| 4.1 New Planner Node            | 50     | Erik Lundell        |
| 4.2 Simple, no Obstacle         | 50     | Erik Lundell        |
| 4.4 Plan Publishing             | 50     | Alexander Lampalzer |
| ------------------------------- | ------ | ------------------- |
| Overall                         | 350    |                     |
